<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<title>Pausen-Timer</title>
<style>
body {
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
  height:100vh;
  margin:0;
}
.container {
  max-width:600px;
  width:100%;
}
#progress {
  width:100%;
  height:20px;
  background:#333;
  border-radius:10px;
  margin-top:10px;
}
#bar {
  height:100%;
  width:0;
  background:#00ff83;
  border-radius:10px;
  transition:width 1s linear;
}
.big { font-size:48px; font-weight:bold; }
.medium { font-size:24px; margin-top:5px; }
</style>
</head>
<body>
<div class="container">
  <div class="big" id="countdown">0:00</div>
  <div class="medium" id="returnTime">End: --:--</div>
  <div id="progress"><div id="bar"></div></div>
</div>

<script>
async function startOverlay(){
  const countdownEl = document.getElementById("countdown");
  const returnEl = document.getElementById("returnTime");
  const barEl = document.getElementById("bar");

  setInterval(async ()=>{
    const status = await fetch("/api/status").then(r=>r.json());
    let remaining = status.paused ? status.remainingMs : (status.endTime - Date.now());
    if(remaining < 0) remaining = 0;

    const mins = Math.floor(remaining/60000);
    const secs = Math.floor((remaining%60000)/1000);
    countdownEl.innerText = `${mins}:${secs.toString().padStart(2,"0")}`;

    const endTime = status.paused ? new Date(Date.now()+status.remainingMs) : new Date(status.endTime);
    returnEl.innerText = `End: ${endTime.getHours().toString().padStart(2,"0")}:${endTime.getMinutes().toString().padStart(2,"0")}`;

    // Progressbar
    let totalMs = status.totalMs || 1;
    barEl.style.width = `${100 - (remaining/totalMs * 100)}%`;
  }, 1000);
}

startOverlay();
</script>
</body>
</html>
